"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[709],{7709:(K,g,r)=>{r.r(g),r.d(g,{StaffListModule:()=>G});var u=r(7087),m=r(3759),_=r(3241),x=r(1348),v=r.t(x,2),t=r(2283),A=r(4758),y=r(6655),C=r(8878),k=r(1359),f=r(9347),h=r(8464),Z=r(3578),b=r(5499);const T=["editControlTrigger"],S=["excelUpload"];function w(s,p){if(1&s){const e=t.EpF();t.TgZ(0,"div",27)(1,"app-dynamic-form",28),t.NdJ("result",function(a){t.CHM(e);const n=t.oxw(3);return t.KtG(n.onGetdefaData(a))}),t.qZA(),t.TgZ(2,"div",29)(3,"mat-icon",30),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.onClearAppoint())}),t._uU(4,"clear"),t.qZA(),t._uU(5," \xa0 "),t.TgZ(6,"mat-icon",30),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2).$implicit,n=t.oxw();return t.KtG(n.onSaveAppoint(a))}),t._uU(7,"done"),t.qZA()()()}if(2&s){const e=t.oxw(3);t.xp6(1),t.Q6J("jsonFormData",e.schemaAppoint)}}function U(s,p){if(1&s&&(t.TgZ(0,"div",37)(1,"div")(2,"strong"),t._uU(3,"Contacto:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div")(6,"strong"),t._uU(7,"Correo:"),t.qZA(),t._uU(8),t.qZA(),t.TgZ(9,"div")(10,"strong"),t._uU(11,"Tel\xe9fono:"),t.qZA(),t._uU(12),t.qZA(),t.TgZ(13,"div")(14,"strong"),t._uU(15,"Tareas:"),t.qZA(),t._uU(16),t.qZA()()),2&s){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",e.contact,""),t.xp6(4),t.hij(" ",e.email,""),t.xp6(4),t.hij(" ",e.phone,""),t.xp6(4),t.Oqu(e.task)}}function L(s,p){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",31)(2,"div",32),t.NdJ("click",function(){const n=t.CHM(e).$implicit,o=t.oxw(3);return t.KtG(o.onchangefull(n))}),t._uU(3),t.ALo(4,"date"),t.qZA(),t.TgZ(5,"div",33)(6,"mat-icon",34),t.NdJ("click",function(){const n=t.CHM(e).index,o=t.oxw(2).$implicit,c=t.oxw();return t.KtG(c.onDelAppoint(o,n))}),t._uU(7,"delete_otuline"),t.qZA(),t.TgZ(8,"mat-icon",34),t.NdJ("click",function(){const n=t.CHM(e).index,o=t.oxw(2).$implicit,c=t.oxw();return t.KtG(c.onEditAppoint(o,n))}),t._uU(9,"edit"),t.qZA(),t.TgZ(10,"mat-icon",35),t.NdJ("click",function(){const n=t.CHM(e).$implicit,o=t.oxw(3);return t.KtG(o.onchangefull(n))}),t._uU(11),t.qZA()()(),t.YNc(12,U,17,4,"div",36),t.qZA()}if(2&s){const e=p.$implicit,i=t.oxw(3);t.xp6(3),t.AsE(" ",t.xi3(4,4,e.datetime,"short")," - ",e.costumer," "),t.xp6(8),t.Oqu(i.getAppIcon(e)),t.xp6(1),t.Q6J("ngIf",e.full)}}function q(s,p){if(1&s){const e=t.EpF();t.TgZ(0,"div",22)(1,"div",23)(2,"div",24),t._uU(3," AGENDA "),t.qZA(),t.TgZ(4,"mat-icon",25),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onAddAppoint())}),t._uU(5,"add"),t.qZA()(),t.YNc(6,w,8,1,"div",26),t.YNc(7,L,13,7,"div",4),t.qZA()}if(2&s){const e=t.oxw().$implicit,i=t.oxw();t.xp6(6),t.Q6J("ngIf",i.addApp),t.xp6(1),t.Q6J("ngForOf",e.appoint)}}const J=function(s){return{"background-color":s}};function E(s,p){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",9)(2,"div",10),t._UZ(3,"img",11),t.TgZ(4,"div",12)(5,"div",13)(6,"div",14),t._uU(7),t.qZA(),t.TgZ(8,"div",15)(9,"div",16)(10,"strong"),t._uU(11,"M\xf3vil:"),t.qZA(),t._uU(12),t.qZA(),t.TgZ(13,"div",16)(14,"strong"),t._uU(15,"Email:"),t.qZA(),t._uU(16),t.qZA(),t.TgZ(17,"div",16)(18,"strong"),t._uU(19,"Calificaci\xf3n:"),t.qZA(),t._uU(20),t.qZA()(),t.TgZ(21,"div",17)(22,"div",18)(23,"span")(24,"mat-icon",19),t.NdJ("click",function(){const n=t.CHM(e).$implicit,o=t.oxw();return t.KtG(o.getStaffClicked(n,1))}),t._uU(25,"perm_identity"),t.qZA(),t.TgZ(26,"mat-icon",20),t._uU(27,"task_alt"),t.qZA(),t.TgZ(28,"mat-icon",20),t._uU(29,"forum"),t.qZA()(),t._uU(30," \xa0 "),t.TgZ(31,"span")(32,"mat-icon",19),t.NdJ("click",function(){const n=t.CHM(e).$implicit,o=t.oxw();return t.KtG(o.getStaffClicked(n,2))}),t._uU(33,"delete"),t.qZA(),t.TgZ(34,"mat-icon",19),t.NdJ("click",function(){const n=t.CHM(e).$implicit,o=t.oxw();return t.KtG(o.getStaffClicked(n,0))}),t._uU(35,"lock_open"),t.qZA(),t.TgZ(36,"mat-icon",19),t.NdJ("click",function(){const n=t.CHM(e).$implicit,o=t.oxw();return t.KtG(o.getStaffClicked(n,1))}),t._uU(37,"edit"),t.qZA(),t.TgZ(38,"mat-icon",19),t.NdJ("click",function(){const n=t.CHM(e).$implicit,o=t.oxw();return t.KtG(o.getStaffClicked(n,3))}),t._uU(39,"pending_actions"),t.qZA()()()(),t.YNc(40,q,8,2,"div",21),t.qZA()()()()()}if(2&s){const e=p.$implicit,i=t.oxw();t.xp6(1),t.Q6J("ngStyle",t.VKq(8,J,i.getBackColor(e))),t.xp6(2),t.Q6J("src",i.getPicture(e),t.LSH),t.xp6(4),t.AsE("",e.names," ",e.second_names,""),t.xp6(5),t.hij(" ",e.phone," "),t.xp6(4),t.hij(" ",e.email," "),t.xp6(4),t.hij(" ",e.stars," "),t.xp6(20),t.Q6J("ngIf","A1"===e.tag)}}const N=[{path:"",component:(()=>{class s{constructor(e,i,a,n,o){this.sharedvar=e,this.dtb=i,this.dg=a,this.snkBar=n,this.route=o,this.addApp=!1,this.arol="K",this.loading=!1,this.staffList=[],this.schemaAppoint={controls:[{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"costumer",label:"Cliente",type:"text",sideBtn:"people",validators:{}},{name:"contact",label:"Contacto",type:"text",sideBtn:"person",validators:{}},{name:"task",label:"Actividad/Compromiso:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}}]}}ngOnInit(){var e=this;return(0,_.Z)(function*(){e.sub=e.route.params.subscribe(function(){var i=(0,_.Z)(function*(a){e.arol=a.rol,e.staffList=yield e.dtb.getStaffByFilterAsync({queryType:3,active:!0,stars:0,rol:e.arol})});return function(a){return i.apply(this,arguments)}}())})()}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}getBackColor(e){return e.active?"white":"#ffffcc"}getPicture(e){return e.picture&&e.picture.length>0?e.picture:"../assets/images/favicon.png"}getClicked(e){switch(e.index){case 1:"P"===this.arol&&this.filterDialog();break;case 2:this.onStaff();break;case 3:let i=document.getElementById("spanTrigger");i&&(i.style.display="",i.style.position="absolute",i.style.left=e.pageX+5+"px",i.style.top=e.pageY+5+"px",this.editControlTrigger.openMenu())}}getStaffClicked(e,i){var a=this;switch(i){case 0:this.snkBar.open(`Rieniciar contrase\xf1a: ${e.names} ${e.second_names}?.`,"Ok",{duration:5e3}).onAction().subscribe(n=>{e.password="",this.dtb.updateStaffAsync(e)});break;case 1:this.onStaff(e);break;case 2:if(this.sharedvar.staff._id===e._id)return void this.snkBar.open(`No es posible eliminar al propietario de \xe9sta sesi\xf3n: ${e.names} ${e.second_names}?.`,"Ok",{duration:5e3});this.snkBar.open(`Eliminar tasker: ${e.names} ${e.second_names}?.`,"Ok",{duration:5e3}).onAction().subscribe(function(){var n=(0,_.Z)(function*(o){if(e.active=!1,yield a.dtb.deleteStaffAsync(e._id)){const l=a.staffList.findIndex(d=>d._id===e._id);l>0&&a.staffList.splice(l,1)}});return function(o){return n.apply(this,arguments)}}());break;case 3:e.tag=e.tag="A1"===e.tag?"A0":"A1",this.addApp=!1,this.dtb.updateStaffAsync(e)}}onStaff(e=null){const i=JSON.parse(JSON.stringify(v));if("K"===this.arol){const o=i.controls.findIndex(c=>"rol"===c.name);o>=0&&i.controls.splice(o,1)}let a=!1;e||(e={},a=!0);let n={schema:i,value:e,title:"Datos del Administrador/Tasker",showImage:!0,image:e.picture,imgwidth:200,imgheight:200,newUsr:a};this.dg.aDefault(n).subscribe(o=>{o&&e&&(this.dg.updatePropResult(e,o),e.rol||(e.rol=[]),"K"===this.arol&&!e.rol.includes(this.arol)&&e.rol.push("K"),e.rol.includes("A")||e.rol.push("A"),n.image&&(e.picture=n.image),this.dtb.setStaff(e).subscribe({next:l=>{e=l;const d=this.staffList.findIndex($=>$._id===l._id);d>=0?this.staffList[d]=l:this.staffList.push(l)}}),navigator.clipboard.writeText(`${this.sharedvar.TASKY_SERVER}tasker/?staff=${e.email}`).then(l=>{}).catch(l=>alert(l)),this.snkBar.open("V\xednculo al cliente copiado al portapapeles.","Ok",{duration:3e3}))})}onExcel2Dtb(e){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(e){const i=e.target.files[0];this.loading=!this.loading,this.dtb.upload2Excel("staff",i).subscribe({next:a=>{this.loading=!1,this.snkBar.open("Base de tasker/usuarios actualizada","Ok",{duration:1e4}).onAction().subscribe(n=>{location.reload()})}})}onchangefull(e){e.full=!e.full}getAppIcon(e){return e.full?"expand_less":"expand_more"}onDelAppoint(e,i){!e.appoint||0===e.appoint.length||this.snkBar.open("Eliminar item de la agenda?.","Ok",{duration:5e3}).onAction().subscribe(a=>{e.appoint?.splice(i,1),this.dtb.updateStaffAsync(e)})}onEditAppoint(e,i){var a=this;let o="Editar agenda: ";e.appoint&&e.appoint[i].costumer&&(o+=e.appoint[i].costumer),this.dg.aDefault({schema:{controls:[{name:"datetime",label:"Fecha y hora:",type:"datetime-local",validators:{required:!0}},{name:"task",label:"Actividad/Compromiso:",type:"textarea",totalRows:4,style:"w-full",validators:{required:!0}}]},title:o,dgwidth:400,dgheigth:400}).subscribe(function(){var l=(0,_.Z)(function*(d){d&&e.appoint&&(e.appoint[i].datetime=d.datetime,e.appoint[i].task=d.taks,a.dtb.updateStaffAsync(e))});return function(d){return l.apply(this,arguments)}}())}onAddAppoint(){this.addApp=!0}onClearAppoint(){this.addApp=!1}onSaveAppoint(e){this.appointData&&this.appointData._valid_&&(e.appoint?.push(this.appointData),this.dtb.updateStaffAsync(e),this.addApp=!1)}onGetdefaData(e){console.log(this.appointData),this.appointData=e}filterDialog(){var e=this;this.dg.aDefault({schema:{controls:[{name:"active",label:"Estado:",type:"select",validators:{},selectOptions:[{key:"1",value:"Activo"},{key:"0",value:"Inactivo"}]},{name:"rol",label:"Rol:",type:"select",validators:{},selectOptions:[{key:"F",value:"Administrador"},{key:"K",value:"Tasker"}]},{name:"email",label:"Correo electr\xf3nico:",type:"text",style:"w-full",validators:{}}]},title:"Filtros",dgwidth:300,dgheigth:400}).subscribe(function(){var n=(0,_.Z)(function*(o){if(o){const c={queryType:3,rol:o.rol,email:o.email};o.active&&(c.active="1"===o.active),e.staffList=yield e.dtb.getStaffByFilterAsync(c)}});return function(o){return n.apply(this,arguments)}}())}static#t=this.\u0275fac=function(i){return new(i||s)(t.Y36(A.D),t.Y36(y.k),t.Y36(C.x),t.Y36(k.ux),t.Y36(m.gz))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-staff-list"]],viewQuery:function(i,a){if(1&i&&(t.Gf(T,5),t.Gf(S,5)),2&i){let n;t.iGM(n=t.CRH())&&(a.editControlTrigger=n.first),t.iGM(n=t.CRH())&&(a.excelUpload=n.first)}},decls:14,vars:4,consts:[[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"p-2","gap-2"],[4,"ngFor","ngForOf"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[1,"w-full","rounded","shadow-sm",3,"ngStyle"],[1,"flex","flex-row"],["alt","aja",1,"h-16","w-16","rounded-full","object-fill",3,"src"],[1,"flex-1"],[1,"flex","flex-col","items-start","px-2"],[1,"h-6","w-48","overflow-hidden","font-medium","leading-tight"],[1,"flex","flex-row","h-6","mt-1"],[1,"pl-2","h-5","w-48","text-xs","overflow-hidden"],[1,"w-full","h-6","px-1","border-t","border-gray-300","flex","flex-row","gap-x-4","justify-end","text-gray-300"],[1,"pt-1"],[1,"hover:text-violet-500",3,"click"],[1,"hover:text-violet-500"],["class","w-full mt-2 bg-gray-50 border-b border-gray-300",4,"ngIf"],[1,"w-full","mt-2","bg-gray-50","border-b","border-gray-300"],[1,"h-6","flex","flex-row","items-end","justify-end","bg-gray-200","text-sm"],[1,"flex-1","ml-1","pt-1","text-sky-700"],[1,"text-gray-400","hover:text-sky-700",3,"click"],["class","p-4 border border-gray-200",4,"ngIf"],[1,"p-4","border","border-gray-200"],[3,"jsonFormData","result"],[1,"h-6","flex","flex-row","items-end","justify-end","bg-gray-200","text-sm","text-gray-400"],["color","warn",3,"click"],[1,"pl-2","flex","flex-row","text-xs","text-sky-700","items-center"],[1,"flex-1","h-6",3,"click"],[1,"text-gray-300"],[1,"text-sm","hover:text-sky-700",3,"click"],[1,"hover:text-sky-700",3,"click"],["class","ml-4 mb-2 p-1 bg-slate-100 text-xs text-gray-600",4,"ngIf"],[1,"ml-4","mb-2","p-1","bg-slate-100","text-xs","text-gray-600"]],template:function(i,a){if(1&i&&(t.TgZ(0,"app-header",0),t.NdJ("onClicked",function(o){return a.getClicked(o)}),t.qZA(),t._UZ(1,"span",1,2),t.TgZ(3,"div",3),t.YNc(4,E,41,10,"div",4),t.TgZ(5,"mat-menu",null,5)(7,"button",6),t.NdJ("click",function(o){return a.onExcel2Dtb(o)}),t.TgZ(8,"mat-icon"),t._uU(9,"build"),t.qZA(),t._uU(10," Importar de Excel "),t.qZA(),t._UZ(11,"hr"),t.qZA(),t.TgZ(12,"input",7,8),t.NdJ("change",function(o){return a.onExcelFileSelected(o)}),t.qZA()()),2&i){const n=t.MAs(6);t.Q6J("buttons","11110")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",n),t.xp6(3),t.Q6J("ngForOf",a.staffList)}},dependencies:[u.sg,u.O5,u.PC,f.VK,f.OP,f.p6,h.Hw,Z.G,b.r,u.uU]})}return s})()}];let F=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[m.Bz.forChild(N),m.Bz]})}return s})();var M=r(769),D=r(7572);let G=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.oAB({type:s});static#i=this.\u0275inj=t.cJS({imports:[u.ez,F,f.Tx,h.Ps,M.O,D.N]})}return s})()}}]);