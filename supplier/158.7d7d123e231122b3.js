"use strict";(self.webpackChunktasky_supplier=self.webpackChunktasky_supplier||[]).push([[158],{1158:(N,m,o)=>{o.r(m),o.d(m,{StaffListModule:()=>O});var d=o(7087),f=o(3759),h=o(3241),k=o(1348),C=o.t(k,2),t=o(2283),v=o(4758),S=o(6655),y=o(8878),T=o(1359),u=o(9347),p=o(8464),Z=o(3578);const x=function(s){return{"background-color":s}};let g=(()=>{class s{constructor(){this.onClicked=new t.vpe}ngOnInit(){}getBackColor(){return this.staff.active?"white":"#ffffcc"}getPicture(){return this.staff.picture&&this.staff.picture.length>0?this.staff.picture:"../assets/images/favicon.png"}onClick(i){this.staff.tag=i,this.onClicked.emit(this.staff)}static#t=this.\u0275fac=function(e){return new(e||s)};static#i=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-staff"]],inputs:{staff:"staff"},outputs:{onClicked:"onClicked"},decls:35,vars:9,consts:[[1,"h-32","w-64","flex","flex-col","rounded","border","border-gray-200","p-1","shadow-sm",3,"ngStyle"],[1,"flex","flex-row"],["alt","aja",1,"h-12","w-12","rounded-full","object-fill",3,"src"],[1,"flex","flex-col","items-start","px-2"],[1,"h-6","w-48","overflow-hidden","font-medium","leading-tight"],[1,"pl-2","h-5","w-48","font-light","text-xs","overflow-hidden"],[1,"w-48","h-6","px-1","border-t","border-violet-300","flex","flex-row","gap-x-4","justify-end","text-violet-300"],[1,"pt-1"],[1,"hover:text-gray-900",3,"click"],[1,"hover:text-gray-900"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"img",2),t.TgZ(3,"div",3)(4,"div",4),t._uU(5),t.qZA(),t.TgZ(6,"div",5)(7,"strong"),t._uU(8,"M\xf3vil:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div",5)(11,"strong"),t._uU(12,"email:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div",5)(15,"strong"),t._uU(16,"Calificaci\xf3n:"),t.qZA(),t._uU(17),t.qZA(),t.TgZ(18,"div",6)(19,"div",7)(20,"span")(21,"mat-icon",8),t.NdJ("click",function(){return n.onClick("1")}),t._uU(22,"perm_identity"),t.qZA(),t.TgZ(23,"mat-icon",9),t._uU(24,"task_alt"),t.qZA(),t.TgZ(25,"mat-icon",9),t._uU(26,"forum"),t.qZA()(),t._uU(27," \xa0 "),t.TgZ(28,"span")(29,"mat-icon",8),t.NdJ("click",function(){return n.onClick("2")}),t._uU(30,"delete"),t.qZA(),t.TgZ(31,"mat-icon",8),t.NdJ("click",function(){return n.onClick("0")}),t._uU(32,"lock_open"),t.qZA(),t.TgZ(33,"mat-icon",8),t.NdJ("click",function(){return n.onClick("1")}),t._uU(34,"edit"),t.qZA()()()()()()()),2&e&&(t.Q6J("ngStyle",t.VKq(7,x,n.getBackColor())),t.xp6(2),t.Q6J("src",n.getPicture(),t.LSH),t.xp6(3),t.AsE("",n.staff.names," ",n.staff.second_names,""),t.xp6(4),t.hij(" ",n.staff.phone,""),t.xp6(4),t.hij(" ",n.staff.email,""),t.xp6(4),t.hij(" ",n.staff.stars,""))},dependencies:[d.PC,p.Hw]})}return s})();const b=["editControlTrigger"],A=["excelUpload"];function U(s,E){if(1&s){const i=t.EpF();t.TgZ(0,"div")(1,"app-staff",9),t.NdJ("onClicked",function(){const a=t.CHM(i).$implicit,r=t.oxw();return t.KtG(r.getStaffClicked(a))}),t.qZA()()}if(2&s){const i=E.$implicit;t.xp6(1),t.Q6J("staff",i)}}const L=[{path:"",component:(()=>{class s{constructor(i,e,n,a,r){this.sharedvar=i,this.dtb=e,this.dg=n,this.snkBar=a,this.route=r,this.arol="K",this.loading=!1,this.staffList=[]}ngOnInit(){var i=this;return(0,h.Z)(function*(){i.sub=i.route.params.subscribe(function(){var e=(0,h.Z)(function*(n){i.arol=n.rol,i.staffList=yield i.dtb.getStaffByFilterAsync({queryType:1,active:!0,stars:0,rol:i.arol})});return function(n){return e.apply(this,arguments)}}())})()}ngOnDestroy(){this.sub&&this.sub.unsubscribe()}getClicked(i){switch(i.index){case 2:this.onStaff();break;case 3:let e=document.getElementById("spanTrigger");e&&(e.style.display="",e.style.position="absolute",e.style.left=i.pageX+5+"px",e.style.top=i.pageY+5+"px",this.editControlTrigger.openMenu())}}getStaffClicked(i){var e=this;switch(i.tag){case"0":this.snkBar.open(`Rieniciar contrase\xf1a: ${i.names} ${i.second_names}?.`,"Ok",{duration:5e3}).onAction().subscribe(n=>{i.password="",this.dtb.updateStaffAsync(i)});break;case"1":this.onStaff(i);break;case"2":if(this.sharedvar.staff._id===i._id)return void this.snkBar.open(`No es posible eliminar al propietario de \xe9sta sesi\xf3n: ${i.names} ${i.second_names}?.`,"Ok",{duration:5e3});this.snkBar.open(`Eliminar tasker: ${i.names} ${i.second_names}?.`,"Ok",{duration:5e3}).onAction().subscribe(function(){var n=(0,h.Z)(function*(a){if(i.active=!1,yield e.dtb.deleteStaffAsync(i._id)){const l=e.staffList.findIndex(c=>c._id===i._id);l>0&&e.staffList.splice(l,1)}});return function(a){return n.apply(this,arguments)}}())}}onStaff(i=null){const e=JSON.parse(JSON.stringify(C));if("K"===this.arol){const r=e.controls.findIndex(l=>"rol"===l.name);r>=0&&e.controls.splice(r,1)}let n=!1;i||(i={},n=!0);let a={schema:e,value:i,title:"Datos del Administrador/Tasker",showImage:!0,image:i.picture,imgwidth:300,imgheight:300,newUsr:n};this.dg.aDefault(a).subscribe(r=>{r&&i&&(this.dg.updatePropResult(i,r),i.rol||(i.rol=[]),"K"===this.arol&&!i.rol.includes(this.arol)&&i.rol.push("K"),i.rol.includes("A")||i.rol.push("A"),a.image&&(i.picture=a.image),this.dtb.setStaff(i).subscribe({next:c=>{i=c;const _=this.staffList.findIndex(j=>j._id===c._id);_>=0?this.staffList[_]=c:this.staffList.push(c)}}),navigator.clipboard.writeText(`${this.sharedvar.TASKY_SERVER}tasker/?staff=${i.email}`).then(c=>{}).catch(c=>alert(c)),this.snkBar.open("V\xednculo al cliente copiado al portapapeles.","Ok",{duration:3e3}))})}onExcel2Dtb(i){this.excelUpload&&this.excelUpload.nativeElement.click()}onExcelFileSelected(i){const e=i.target.files[0];this.loading=!this.loading,this.dtb.upload2Excel("staff",e).subscribe({next:n=>{this.loading=!1,this.snkBar.open("Base de tasker/usuarios actualizada","Ok",{duration:1e4}).onAction().subscribe(a=>{location.reload()})}})}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(v.D),t.Y36(S.k),t.Y36(y.x),t.Y36(T.ux),t.Y36(f.gz))};static#i=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-staff-list"]],viewQuery:function(e,n){if(1&e&&(t.Gf(b,5),t.Gf(A,5)),2&e){let a;t.iGM(a=t.CRH())&&(n.editControlTrigger=a.first),t.iGM(a=t.CRH())&&(n.excelUpload=a.first)}},decls:14,vars:4,consts:[[3,"buttons","nav_menu","onClicked"],["id","spanTrigger",3,"matMenuTriggerFor"],["editControlTrigger","matMenuTrigger"],[1,"flex","flex-wrap","p-2","gap-1"],[4,"ngFor","ngForOf"],["controlEdit","matMenu"],["mat-menu-item","",3,"click"],["type","file","accept",".xlsx",1,"invisible",3,"change"],["excelUpload",""],[3,"staff","onClicked"]],template:function(e,n){if(1&e&&(t.TgZ(0,"app-header",0),t.NdJ("onClicked",function(r){return n.getClicked(r)}),t.qZA(),t._UZ(1,"span",1,2),t.TgZ(3,"div",3),t.YNc(4,U,2,1,"div",4),t.qZA(),t.TgZ(5,"mat-menu",null,5)(7,"button",6),t.NdJ("click",function(r){return n.onExcel2Dtb(r)}),t.TgZ(8,"mat-icon"),t._uU(9,"build"),t.qZA(),t._uU(10," Importar de Excel "),t.qZA(),t._UZ(11,"hr"),t.qZA(),t.TgZ(12,"input",7,8),t.NdJ("change",function(r){return n.onExcelFileSelected(r)}),t.qZA()),2&e){const a=t.MAs(6);t.Q6J("buttons","11110")("nav_menu",!1),t.xp6(1),t.Q6J("matMenuTriggerFor",a),t.xp6(3),t.Q6J("ngForOf",n.staffList)}},dependencies:[d.sg,u.VK,u.OP,u.p6,p.Hw,Z.G,g]})}return s})()}];let J=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#i=this.\u0275mod=t.oAB({type:s});static#e=this.\u0275inj=t.cJS({imports:[f.Bz.forChild(L),f.Bz]})}return s})();var B=o(769);const w=[{path:"",component:g}];let F=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#i=this.\u0275mod=t.oAB({type:s});static#e=this.\u0275inj=t.cJS({imports:[f.Bz.forChild(w),f.Bz]})}return s})(),M=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#i=this.\u0275mod=t.oAB({type:s});static#e=this.\u0275inj=t.cJS({imports:[d.ez,F,p.Ps]})}return s})(),O=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#i=this.\u0275mod=t.oAB({type:s});static#e=this.\u0275inj=t.cJS({imports:[d.ez,J,u.Tx,p.Ps,B.O,M]})}return s})()}}]);